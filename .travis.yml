language: php
php:
  - '7.0'
dist: xenial

sudo: required

services:
  - docker

deploy:
  provider: s3
  access_key_id: $S3_ACCESS_KEY
  secret_access_key: $S3_SECRET_KEY
  bucket: $S3_BUCKET
  skip_cleanup: true

script: composer test 

before_install:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then 
    docker build -t studionone/travis-flynn-test:latest .;
    fi
  - if [ "$TRAVIS_BRANCH" == "develop" ]; then
    docker build -t studionone/travis-flynn-test:develop .;
    fi
  - docker ps -a  

after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then
    docker login -u $DOCKER_PRODUCTION_USERNAME -p $DOCKER_PRODUCTION_PASSWORD  repository.studionone.io;
    docker push studionone/travis-flynn-test;
    fi
  - if [ "$TRAVIS_BRANCH" == "develop" ]; then
    docker login -u $DOCKER_PRODUCTION_USERNAME  -p $DOCKER_PRODUCTION_PASSWORD repository.studionone.io;
    docker tag studionone/travis-flynn-test:develop repository.studionone.io/travis-flynn-test:develop;
    docker push repository.studionone.io/travis-flynn-test:develop;
    fi 
